datasource db {
    provider = "postgresql"
    url      = env("DB_URL")
}

generator client {
    provider = "prisma-client-js"
}

model User {
    id            String  @id @default(cuid())
    email         String  @unique
    name          String
    password_hash String?

    Session             Session[]
    ExternalUserAccount ExternalUserAccount[]
    Certification       Certification[]

    @@map("users")
}

model Session {
    token   String @id
    user_id String

    User User @relation(fields: [user_id], references: [id])

    @@map("sessions")
}

model ExternalUserAccount {
    user_id          String
    provider         String // "GOOGLE" | "GITHUB" | "FACEBOOK" | ...
    provider_user_id String

    access_token                  String
    refresh_token                 String?
    access_token_expiry_datetime  DateTime?
    refresh_token_expiry_datetime DateTime?

    User User @relation(fields: [user_id], references: [id])

    @@id([user_id, provider])
    @@unique([provider, provider_user_id])
    @@map("external_user_accounts")
}

model Certification {
    id      String @id @default(cuid())
    user_id String
    title   String

    User     User      @relation(fields: [user_id], references: [id])
    Template Template?

    @@map("certifications")
}

model Template {
    id String @id

    file_id        String?
    bucket_url     String?
    type           String // "URL" | "GOOGLE_DRIVE" | "UPLOAD"
    certificate_id String  @unique

    Certification    Certification      @relation(fields: [certificate_id], references: [id])
    TemplateVariable TemplateVariable[]

    @@map("templates")
}

model TemplateVariable {
    template_id String
    name        String

    Template Template @relation(fields: [template_id], references: [id])

    @@id([name, template_id])
    @@map("template_variables")
}
