services:
  database:
    image: postgres
    container_name: certificate-management-db
    ports:
        - 5433:5432
    environment:
        - POSTGRES_USER=${DB_USER}
        - POSTGRES_PASSWORD=${DB_PASSWORD}
        - POSTGRES_DB=${DB_NAME}
    volumes:
        - database:/var/lib/postgresql
    networks:
        - certificate-management
  cache:
    image: redis
    container_name: certificate-management-cache
    ports:
        - 6380:6379
    networks:
        - certificate-management

  # pubsub-emulator:
  #   image: gcr.io/google.com/cloudsdktool/google-cloud-cli:emulators
  #   ports:
  #     - "8085:8085"
  #   command: gcloud beta emulators pubsub start --host-port=0.0.0.0:8085 --project=${GCP_PROJECT_ID}
  #   # I can use the url http://localhost:8085/v1/projects/SEU_PROJECT_ID/topics to check if the topics are created
  #   healthcheck:
  #     test: ["CMD", "curl", "-f", "http://localhost:8085/"]
  #     interval: 5s
  #     timeout: 2s
  #     retries: 10

  # pubsub-setup:
  #   image: gcr.io/google.com/cloudsdktool/google-cloud-cli:emulators
  #   container_name: pubsub-setup
  #   volumes:
  #     - ./scripts/setup-pubsub.sh:/app/setup-pubsub.sh
  #   environment:
  #     - GCP_PROJECT_ID=${GCP_PROJECT_ID}
  #     - PUBSUB_EMULATOR_HOST=pubsub-emulator:8085
  #   # O entrypoint substitui o comando padr√£o e roda o seu script
  #   entrypoint: ["/bin/bash", "/app/setup-pubsub.sh"]
  #   depends_on:
  #     pubsub-emulator:
  #       condition: service_healthy
        
  # grafana:
  #   container_name: certificate-management-grafana
  #   image: grafana/grafana
  #   ports:
  #     - 3005:3000
  #   environment:
  #     - GF_AUTH_ANONYMOUS_ENABLED=true
  #     - GF_AUTH_ANONYMOUS_ORG_ROLE=Admin
  #   depends_on:
  #     - database
  #   networks:
  #     - certificate-management
  #   volumes:
  #     - grafana:/var/lib/grafana
  
  # loki:
  #   container_name: certificate-management-loki
  #   image: grafana/loki
  #   ports:
  #     - 3100:3100
  #   command: -config.file=/etc/loki/local-config.yaml
  #   volumes:
  #     - ./loki-config.yaml:/etc/loki/local-config.yaml
  #   networks:
  #     - certificate-management
  
  # otel-collector:
  #   image: otel/opentelemetry-collector-contrib
  #   command: ["--config=/etc/otel-collector-config.yaml"]
  #   volumes:
  #     - ./otel-collector-config.yaml:/etc/otel-collector-config.yaml
  #   ports:
  #     - "4318:4318"
  #     - "4317:4317"
  #   depends_on:
  #     - loki
  #   networks:
  #     - certificate-management

volumes:
  database:
  grafana:

networks:
  certificate-management: